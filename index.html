<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Flag catching by ee106a-fa15-team01</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Flag catching</h1>
      <h2 class="project-tagline">Final project for EE 106A Fall 2015</h2>
      <a href="https://github.com/ee106a-fa15-team01/flag_catching" class="btn">View on GitHub</a>
      <a href="https://github.com/ee106a-fa15-team01/flag_catching/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ee106a-fa15-team01/flag_catching/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h1>

<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<p>For this project, we set a game called "Flag Catching". The rule is quite simple but useful in the reality. There are two sides in this game. One is attacking and the other one is defending. They will fight against each other. Each side can be composed of more than one robot.</p>

<p>For the defender, it should keep the attacker away from the flag which means to chase it. The initial place for the defender can be randomly chosen. If the defender catch the attacker, defending side wins the game.  </p>

<p>On the other hand, the attacker ahould catch the flag and avoid the defender at the same time. The attacker moves toward the flag then return to the home region. That is, once the attacker completes the above step succesfully will win the game.</p>

<h2>
<a id="interesting-parts-in-this-project" class="anchor" href="#interesting-parts-in-this-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interesting parts in this project</h2>

<p>It's fun to watch this game, since the result is unpredicable. 
Another point is we can apply potential field theorem into this game. This will be illustrated later.</p>

<h2>
<a id="interesting-problems" class="anchor" href="#interesting-problems" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interesting problems</h2>

<ol>
<li>How to avoid obstacles and move to objects?</li>
<li>How to locate each object?</li>
<li>How do the robots make decisions in real time and move smoothly?</li>
</ol>

<h2>
<a id="applications-in-real-world" class="anchor" href="#applications-in-real-world" aria-hidden="true"><span class="octicon octicon-link"></span></a>Applications in real-world</h2>

<p>Automatic industrial vehicles:</p>

<p>Automatic industrial fork truck (trucks with a function of picking up goods at a given location and carrying it back to an assigned home region. The trucks should be able to avoid other trucks and people during the task). 
Autonomous constructional vehicles which pedrail wheels are used for   them, so they tend to have similar moving pattern to Zumy due to the friction conditions. Based on this, the way of controlling the pedrail system should be similar).</p>

<h1>
<a id="design" class="anchor" href="#design" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design</h1>

<h2>
<a id="design-criteria" class="anchor" href="#design-criteria" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design criteria</h2>

<p>The attacker should wisely avoid the defender(do not commit suicide)
The game is played smoothly, in a competitive way.
The players follow the game rule.(attacker capture the flag at first and go to the home region afterwards,defender chase the attacker)
If attacker wins the defender should stop.If defender wins the attacker should stop.</p>

<h2>
<a id="design-we-chose" class="anchor" href="#design-we-chose" aria-hidden="true"><span class="octicon octicon-link"></span></a>Design we chose</h2>

<h3>
<a id="using-a-coordinate-grid" class="anchor" href="#using-a-coordinate-grid" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using a Coordinate Grid</h3>

<p>converting a real position in the ground frame read by the camera to a n by m mesh grid ( in our case 18 by 21) . Since the zumys can't stop at the exact location of the grid, there will be an inevitable error for locating zumys.</p>

<h3>
<a id="path-planning-with-potential-field" class="anchor" href="#path-planning-with-potential-field" aria-hidden="true"><span class="octicon octicon-link"></span></a>Path planning with potential field</h3>

<p>For the attacker, each defender corresponds to a high potential. Initially, the location of the flags corresponds to a low potential. After the attacker get to the flag, the flag no longer has a low potential. Instead, the home region will then has a low potential. </p>

<p>For a defender, the attacker corresponds to a low potential while other defenders each corresponds a high potential.</p>

<p>When doing path planning, each robot will choose a neighbour grid such that has the lowest potential.</p>

<p>But there will be local minima problem for potential field, which can trap the zumys. This is a weakness when using potential field.</p>

<h3>
<a id="global-camera" class="anchor" href="#global-camera" aria-hidden="true"><span class="octicon octicon-link"></span></a>Global camera</h3>

<p>Due to the fact that in order to calculate potential field we need to know the location of everything in the area. So we choose global camera and artags to locate zumys, goal, origin and bond.</p>

<p>Global camera can have an increasingly bigger error while the distance from the zumys increase. However, in order to see the whole playing area, the global camera must increase the distance from the zumys. Moreover, global camera have limited vision. So that we don't have a big or infinite size of playing area. </p>

<h3>
<a id="step" class="anchor" href="#step" aria-hidden="true"><span class="octicon octicon-link"></span></a>step</h3>

<p>To better control the zumys' locations, we contol the zumys step by step. The zumys won't start planning before they get to the next planned location. Since it is easier to control a zumy's location than its velocity.</p>

<p>By using step by step control, while it is easier to control the location of zumy, it is hard for us to control the zumy during the step. </p>

<h1>
<a id="implementation" class="anchor" href="#implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation</h1>

<h3>
<a id="hardware-constructions" class="anchor" href="#hardware-constructions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hardware constructions</h3>

<ol>
<li>"Zumy" is the robot we’re using in this project. It’s provided by EECS department in UC, Berkeley.<br>
pic 7 here</li>
<li>If N Zumys are set in the game, N+3 AR tags in total( +3 each stands for the origin, the goal and one for boundary need) are needed.
pic 4 here</li>
<li>The game field must be smaller than 90 (cm) x 105 (cm) regarding to the limitation of camera vision.</li>
<li>To minimize the errors of coordinate recognition, the camera are set to be on the right top of the origin AR tag</li>
<li>Fully charged batteries for Zumys is desirable in order to solve the problem caused by velocity differences between Zumys, but it has been solved by using PID controller on Zumy</li>
<li>All the AR tags should be recognized well by the camera all the time</li>
</ol>

<h3>
<a id="coordinate-transform" class="anchor" href="#coordinate-transform" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coordinate transform</h3>

<ol>
<li>Scale the real world ground into a virtual grid</li>
<li>Using the camera to locate all the Zumys</li>
<li>Coordinate transform is completed by the tf. lookup transform which transforms the coordinate seen from the camera to the ground coordinate. </li>
<li>Ground frame is formed by placing an AR tag on the ground and set it to be the reference origin for this frame</li>
</ol>

<h3>
<a id="complete-path-planning-by-using-potential-field-method" class="anchor" href="#complete-path-planning-by-using-potential-field-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Complete path planning by using potential field method</h3>

<ol>
<li>Using the following function in our code:
U_obstacle=(1/√(1+〖dist(q,obstacle)〗^6 ))^2 dist(q, goal)^2, when p &gt; dist(q, obstacle)
U_obstacle = 0                              , when p &lt; dist(q, obstacle)
here</li>
<li>Adjust the parameters to let Zumys avoid obstacles properly.</li>
<li>Make the potential field into a readable window which can show us the current potential field value for each current location. 
pic 6 here<br>
### Adding extra linear velocity
Adding an extra linear velocity to rotation after Zumys rotate to the right direction. By adding the linear velocity, we ensure that Zumys won't fall in to the rotation to linear transition state trap, when Zumys tend to frequently change from rotation to linear and then rotation, which stop Zumys from going to the next point. With the additional velocity, the Zumys can always keep forward after turning into the right direction at first.</li>
</ol>

<h2>
<a id="code-detail-diagram-flow-charts-launch-files-urdf" class="anchor" href="#code-detail-diagram-flow-charts-launch-files-urdf" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code detail (diagram, flow charts, launch files, URDF….)</h2>

<h2>
<a id="describe-complete-system-work" class="anchor" href="#describe-complete-system-work" aria-hidden="true"><span class="octicon octicon-link"></span></a>Describe complete system work</h2>

<p>(rqt_graph) pic 9 here 
Zumy 5a is the runner; Zumy 1b and 1c are the catchers (three Zumys in total).
tf delivers the coordinates of the AR tags ( Zumys, origin and goal) to 5a,1b,1c. </p>

<p>The chaser Zumys are all sharing the same module to calculate the potential value while the runner Zumy only calculate its own potential field.</p>

<p>After the calculation, the grid with the smallest potential value will be chose as the next desired coordinate.</p>

<p>After knowing the next assigned point, the Zumys all share the same controlling code. The camera information is included in the code, so the Zumys can move to the next point according to the coordinate information. After finishing each step, coordinates will be evaluated to see if it’s already caught the flag or not. Either side who win the game will publish a "game over" message to the game status topic. All the Zumys are subscribed to this game status topic, so all the velocity commands on the Zummys will become zero (it stops).</p>

<h1>
<a id="results" class="anchor" href="#results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results</h1>

<h2>
<a id="coordinate-transform-1" class="anchor" href="#coordinate-transform-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coordinate transform</h2>

<p>It works quite well after we put an AR tag as a referenced origin. Of course adjust the camera configuration will minimize the error. Also, a filter is wrote in the code for Zumys to get rid of way-off information given from the camera. The error caused by the camera is within 2cm. Compared to the scale we chose for one grid(5 cm) is acceptable.</p>

<p>In order to lower the error, the camera should be placed directly above the origin AR tag.</p>

<h2>
<a id="motion-of-the-zumy" class="anchor" href="#motion-of-the-zumy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motion of the Zumy</h2>

<p>We added an extra linear velocity to the pure rotation movement after the first rotation movement period, so that we avoid the frequent transition between rotation and linear velocity which makes the Zumy shake   </p>

<h2>
<a id="final-video-picture" class="anchor" href="#final-video-picture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Video, picture</h2>

<h1>
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h1>

<ol>
<li>Most of the impact caused by the coordinate errors have been eliminated.</li>
<li>The extra linear velocity added to the pure rotations doesn’t seem to be obvious. The reason is because of the scale for each grid is not big enough for us to see the curve path it performs. However, it keeps Zumys from trapping. </li>
<li>The function we're using for calculating the potential field has been modified quite well. The runner can move forward to the flag and avoiding the chasers well at the same time. 
the performances of the chasers are good enough to catch the runner and keeps itself from crashing into other chasers.</li>
<li>We are able to stop the Zumy correctly by using the "game_status" topic.</li>
</ol>

<h2>
<a id="particular-difficulties" class="anchor" href="#particular-difficulties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Particular difficulties</h2>

<ol>
<li>Zumys lose connection to computers easily. </li>
<li>Better way of controlling the velocity of the Zumy.</li>
<li>The axis seen on rviz was flipping all the time because of the errors caused by the camera especially when two AR tags get too close to each other. </li>
<li>Continuous time method applied to Zumy’s motion turns out to have greater coordinate errors. Discrete method is contrarily a stable way to meet our goals.</li>
<li>Zumys get trapped in a local minima situation.</li>
</ol>

<h1>
<a id="improvements-in-the-future" class="anchor" href="#improvements-in-the-future" aria-hidden="true"><span class="octicon octicon-link"></span></a>Improvements in the future</h1>

<ol>
<li>Continuous time method should also work correctly. </li>
<li>Zumys shouldn’t be trapped in a local minimum value.<br>
</li>
<li>Filter used for the camera can be improved.</li>
<li>For "game over" topic, all the Zumys should stop immediately instead of finishing its current step then stop.</li>
<li>Try to optimize the effect between the chasers Zummy, so that chaser can cooperate with each other to catch the runner.</li>
<li>Try to apply kalman filter</li>
</ol>

<h1>
<a id="team-members" class="anchor" href="#team-members" aria-hidden="true"><span class="octicon octicon-link"></span></a>Team members</h1>

<h2>
<a id="liu-yang" class="anchor" href="#liu-yang" aria-hidden="true"><span class="octicon octicon-link"></span></a>Liu Yang</h2>

<p>A senior, exchange student from China, Beijing Institute of Technology majoring in Electrical Engineering</p>

<h2>
<a id="hsiu-wei-chang" class="anchor" href="#hsiu-wei-chang" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hsiu-Wei Chang</h2>

<p>A junior, exchange student from Taiwan, <a href="http://www.ncue.edu.tw/front/bin/home.phtml">National Changhua University of Education</a> majoring in Electrical Engineering.</p>

<h2>
<a id="rui-zhang-z-rui" class="anchor" href="#rui-zhang-z-rui" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rui Zhang (<a href="https://github.com/z-rui" class="user-mention">@z-rui</a>)</h2>

<p>I am a junior student from <a href="http://www.njust.edu.cn/">Nanjing University of Science and Technology</a>. Good at Python and C programming. As an exchange student in Berkeley I took EE C106A, EE 120 and CS 61C this semester.</p>

<h2>
<a id="yang-yue" class="anchor" href="#yang-yue" aria-hidden="true"><span class="octicon octicon-link"></span></a>Yang Yue</h2>

<p>TODO</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ee106a-fa15-team01/flag_catching">Flag catching</a> is maintained by <a href="https://github.com/ee106a-fa15-team01">ee106a-fa15-team01</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
