{"name":"Flag catching","tagline":"Final project for EE 106A Fall 2015","body":"# Introduction\r\n\r\n## Overview\r\n\r\nFor this project, we set a game called \"Flag Catching\". The rule is quite simple but useful in the reality. There are two sides in this game. One is attacking and the other one is defending. They will fight against each other. Each side can be composed of more than one robot.\r\n\r\nFor the defender, it should keep the attacker away from the flag which means to chase it. The initial place for the defender can be randomly chosen. If the defender catch the attacker, defending side wins the game.  \r\n\r\nOn the other hand, the attacker ahould catch the flag and avoid the defender at the same time. The attacker moves toward the flag then return to the home region. That is, once the attacker completes the above step succesfully will win the game.\r\n\r\n\r\n## Interesting parts in this project \r\n\r\nIt's fun to watch this game, since the result is unpredicable. \r\nAnother point is we can apply potential field theorem into this game. This will be illustrated later.\r\n\r\n## Interesting problems\r\n\r\n1. How to avoid obstacles and move to objects?\r\n2. How to locate each object?\r\n3. How do the robots make decisions in real time and move smoothly?\r\n\r\n## Applications in real-world\r\n\r\nAutomatic industrial vehicles:\r\n\r\nAutomatic industrial fork truck (trucks with a function of picking up goods at a given location and carrying it back to an assigned home region. The trucks should be able to avoid other trucks and people during the task). \r\nAutonomous constructional vehicles which pedrail wheels are used for   them, so they tend to have similar moving pattern to Zumy due to the friction conditions. Based on this, the way of controlling the pedrail system should be similar).\r\n\r\n# Design\r\n\r\n## Design criteria\r\n\r\nThe attacker should wisely avoid the defender(do not commit suicide)\r\nThe game is played smoothly, in a competitive way.\r\nThe players follow the game rule.(attacker capture the flag at first and go to the home region afterwards,defender chase the attacker)\r\nIf attacker wins the defender should stop.If defender wins the attacker should stop.\r\n\r\n## Design we chose\r\n\r\n### Using a Coordinate Grid\r\n\r\nconverting a real position in the ground frame read by the camera to a n by m mesh grid ( in our case 18 by 21) . Since the zumys can't stop at the exact location of the grid, there will be an inevitable error for locating zumys.\r\n\r\n### Path planning with potential field\r\n\r\nFor the attacker, each defender corresponds to a high potential. Initially, the location of the flags corresponds to a low potential. After the attacker get to the flag, the flag no longer has a low potential. Instead, the home region will then has a low potential. \r\n\r\nFor a defender, the attacker corresponds to a low potential while other defenders each corresponds a high potential.\r\n\r\nWhen doing path planning, each robot will choose a neighbour grid such that has the lowest potential.\r\n\r\nBut there will be local minima problem for potential field, which can trap the zumys. This is a weakness when using potential field.\r\n\r\n### Global camera\r\n\r\nDue to the fact that in order to calculate potential field we need to know the location of everything in the area. So we choose global camera and artags to locate zumys, goal, origin and bond.\r\n\r\nGlobal camera can have an increasingly bigger error while the distance from the zumys increase. However, in order to see the whole playing area, the global camera must increase the distance from the zumys. Moreover, global camera have limited vision. So that we don't have a big or infinite size of playing area. \r\n\r\n### step\r\n\r\nTo better control the zumys' locations, we contol the zumys step by step. The zumys won't start planning before they get to the next planned location. Since it is easier to control a zumy's location than its velocity.\r\n\r\nBy using step by step control, while it is easier to control the location of zumy, it is hard for us to control the zumy during the step. \r\n\r\n# Implementation\r\n\r\n### Hardware constructions\r\n\r\n1. \"Zumy\" is the robot we’re using in this project. It’s provided by EECS department in UC, Berkeley.  \r\n pic 7 here\r\n2. If N Zumys are set in the game, N+3 AR tags in total( +3 each stands for the origin, the goal and one for boundary need) are needed.\r\npic 4 here\r\n2. The game field must be smaller than 90 (cm) x 105 (cm) regarding to the limitation of camera vision.\r\n3. To minimize the errors of coordinate recognition, the camera are set to be on the right top of the origin AR tag\r\n4. Fully charged batteries for Zumys is desirable in order to solve the problem caused by velocity differences between Zumys, but it has been solved by using PID controller on Zumy\r\n5. All the AR tags should be recognized well by the camera all the time\r\n\r\n### Coordinate transform\r\n\r\n1. Scale the real world ground into a virtual grid\r\n2. Using the camera to locate all the Zumys\r\n3. Coordinate transform is completed by the tf. lookup transform which transforms the coordinate seen from the camera to the ground coordinate. \r\n4. Ground frame is formed by placing an AR tag on the ground and set it to be the reference origin for this frame\r\n\r\n### Complete path planning by using potential field method\r\n\r\n1. Using the following function in our code:\r\n  U_obstacle=(1/√(1+〖dist(q,obstacle)〗^6 ))^2 dist(q, goal)^2, when p > dist(q, obstacle)\r\n  U_obstacle = 0                              , when p < dist(q, obstacle)\r\nhere\r\n2. Adjust the parameters to let Zumys avoid obstacles properly.\r\n3. Make the potential field into a readable window which can show us the current potential field value for each current location. \r\n pic 6 here    \r\n### Adding extra linear velocity\r\n   Adding an extra linear velocity to rotation after Zumys rotate to the right direction. By adding the linear velocity, we ensure that Zumys won't fall in to the rotation to linear transition state trap, when Zumys tend to frequently change from rotation to linear and then rotation, which stop Zumys from going to the next point. With the additional velocity, the Zumys can always keep forward after turning into the right direction at first.\r\n\r\n## Code detail (diagram, flow charts, launch files, URDF….)\r\n\r\n## Describe complete system work\r\n\r\n(rqt_graph) pic 9 here \r\nZumy 5a is the runner; Zumy 1b and 1c are the catchers (three Zumys in total).\r\ntf delivers the coordinates of the AR tags ( Zumys, origin and goal) to 5a,1b,1c. \r\n\r\nThe chaser Zumys are all sharing the same module to calculate the potential value while the runner Zumy only calculate its own potential field.\r\n\r\nAfter the calculation, the grid with the smallest potential value will be chose as the next desired coordinate.\r\n\r\nAfter knowing the next assigned point, the Zumys all share the same controlling code. The camera information is included in the code, so the Zumys can move to the next point according to the coordinate information. After finishing each step, coordinates will be evaluated to see if it’s already caught the flag or not. Either side who win the game will publish a \"game over\" message to the game status topic. All the Zumys are subscribed to this game status topic, so all the velocity commands on the Zummys will become zero (it stops).\r\n\r\n# Results\r\n\r\n## Coordinate transform\r\n\r\nIt works quite well after we put an AR tag as a referenced origin. Of course adjust the camera configuration will minimize the error. Also, a filter is wrote in the code for Zumys to get rid of way-off information given from the camera. The error caused by the camera is within 2cm. Compared to the scale we chose for one grid(5 cm) is acceptable.\r\n\r\nIn order to lower the error, the camera should be placed directly above the origin AR tag.\r\n\r\n## Motion of the Zumy\r\n\r\nWe added an extra linear velocity to the pure rotation movement after the first rotation movement period, so that we avoid the frequent transition between rotation and linear velocity which makes the Zumy shake   \r\n\r\n## Final Video, picture\r\n\r\n\r\n\r\n# Conclusion\r\n\r\n1. Most of the impact caused by the coordinate errors have been eliminated.\r\n2. The extra linear velocity added to the pure rotations doesn’t seem to be obvious. The reason is because of the scale for each grid is not big enough for us to see the curve path it performs. However, it keeps Zumys from trapping. \r\n3. The function we're using for calculating the potential field has been modified quite well. The runner can move forward to the flag and avoiding the chasers well at the same time. \r\nthe performances of the chasers are good enough to catch the runner and keeps itself from crashing into other chasers.\r\n4. We are able to stop the Zumy correctly by using the \"game_status\" topic.\r\n\r\n## Particular difficulties\r\n\r\n1. Zumys lose connection to computers easily. \r\n2. Better way of controlling the velocity of the Zumy.\r\n3. The axis seen on rviz was flipping all the time because of the errors caused by the camera especially when two AR tags get too close to each other. \r\n4. Continuous time method applied to Zumy’s motion turns out to have greater coordinate errors. Discrete method is contrarily a stable way to meet our goals.\r\n5. Zumys get trapped in a local minima situation.\r\n\r\n# Improvements in the future\r\n\r\n1. Continuous time method should also work correctly. \r\n2. Zumys shouldn’t be trapped in a local minimum value.  \r\n3. Filter used for the camera can be improved.\r\n4. For \"game over\" topic, all the Zumys should stop immediately instead of finishing its current step then stop.\r\n5. Try to optimize the effect between the chasers Zummy, so that chaser can cooperate with each other to catch the runner.\r\n6. Try to apply kalman filter\r\n\r\n# Team members\r\n\r\n## Liu Yang\r\n\r\nA senior, exchange student from China, Beijing Institute of Technology majoring in Electrical Engineering\r\n\r\n## Hsiu-Wei Chang\r\n\r\nA junior, exchange student from Taiwan, [National Changhua University of Education](http://www.ncue.edu.tw/front/bin/home.phtml) majoring in Electrical Engineering.\r\n\r\n## Rui Zhang (@z-rui)\r\n\r\nI am a junior student from [Nanjing University of Science and Technology](http://www.njust.edu.cn/). Good at Python and C programming. As an exchange student in Berkeley I took EE C106A, EE 120 and CS 61C this semester.\r\n\r\n## Yang Yue\r\n\r\nTODO\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}